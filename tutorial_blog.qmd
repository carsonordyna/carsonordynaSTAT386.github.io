---
title: "Tutorial Blog"
format: html
jupyter: python3
---

# The Cox Proportional Hazards Model: A Brief Introduction and Demo

##### Outline
1. Introduction
2. The Mathematical Model
3. A Brief Demo
4. Conclusion

![A doctor's stethoscope](doctor_stethoscope.jpg)

### Introduction

In clinical research, it is valuable to be able to model and predict whether a patient will experience a specified event (e.g. death, the return of a disease like cancer, etc.). Just as important is being able to model and predict ***when*** such an event occurs (e.g. 3 years after the diagnosis of a cancer at a particular stage). This is a foundational focus of survival analysis: the use of statistical models trained on time-to-event data. One of the most common and powerful tools in survival analysis is the Cox Proportional Hazards Model (Cox model for short), which helps us understand how different factors (age, treatment, comorbidities, etc.) influence a given individual's changing, moment-to-moment risk of experiencing a given event over a period of time.

For the last several months, I have had the privilege of working on a clinical research team at Massachusetts General Hospital. As I have reviewed scientific literature regarding lung cancer and surgical pproaches to treating it, I have seen firsthand how prevelent this model is in medical/clinical research. This post offers a brief introduction to the Cox model and a simple, hands-on demo using [Python](https://www.geeksforgeeks.org/data-science/cox-proportional-hazards-model/).


### The Mathematical Model

At the core of the Cox model is the hazard function. A hazard function, $\lambda (t)$, is one that indicates the instantaneous rate of an event occurring—in other words, the instantaneous risk of experiencing the event (e.g. death)—at a specific time, $t$. The baseline hazard function $\lambda_0 (t)$ refers to the hazard function when explanatory variables (i.e. covariates), $X$, are at their baseline levels (e.g. when no treatment/medication is given, when a particular comorbidity is not present, etc.). That is, $X_i = 0$ for all $i \in \{1, 2, ..., n \}$ for $n$ covariates. The effect of each covariate is denoted as $\beta$ with $\beta_i$ denoting the effect of the $i$-th covariate. The overall hazard function, $\lambda(t \mid X)$, is as follows:

$$
\lambda(t \mid X) = \lambda_0 (t) e^{\displaystyle \beta_1 X_1 + \beta_2 X_2 + \cdots + \beta_n X_n}
$$

where $X =$ $(X_1, X_2, ..., X_n)$ is the covariate vector. Note that if $\beta_i > 0$, then increasing $X_i$ (or $X_i = 1$ if binary) means an increased risk, and if $\beta_i < 0$, then increasing $X_i$ (or $X_i = 1$ if binary) means a decreased risk. In the case of a single covariate, $\beta_1$, it can be shown that

$$
\frac{\lambda(t \mid x + 1)}{\lambda(t \mid x)} = e^{\displaystyle \beta_1}
$$

When comparing two patients, $a$ and $b$, in the single covariate case, it can also be shown that

$$
\frac{\lambda(t \mid X_a)}{\lambda(t \mid X_b)} = e^{\displaystyle \beta_1(X_a - X_b)}
$$

The right-hand side of these equations are constants independent of time, $t$. These presence of these ***constant*** proportions are the reason why the model is called the Cox ***Proportional Hazards*** model. The derivation of these results and deeper mathematical theory and background behind the model is beyond the scope of this blog. More information may be found [here](https://en.wikipedia.org/wiki/Proportional_hazards_model)

![Hazard Function Graph](harzard_graph.png)


### A Brief Demo

Now, I'll present a simple example (using the `lifelines` Python library, [link to documentation](https://lifelines.readthedocs.io/en/latest/)) of how to fit and interpret a Cox model on a small, synthetic dataset.

```{python}
#| eval: false
#| warning: false
# Install "lifelines" library if not already installed
!pip install lifelines
```
```{python}
# Import libraries
#| warning: false
import pandas as pd
from lifelines import CoxPHFitter

# Sample dataset
data = pd.DataFrame({
    'age': [79, 50, 45, 70, 65, 70, 53, 66, 50, 77, 58, 70, 53, 56, 71, 76, 60, 75, 68, 76],
    'treatment': [0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1],
    'gender': [1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0],
    'duration': [1, 5, 2, 3, 5, 2, 5, 5, 5, 2, 5, 5, 4, 2, 5, 5, 4, 1, 5, 5],
    'event': [1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1]
})

# Fit the Cox model
cph = CoxPHFitter()
cph.fit(data, duration_col='duration', event_col='event')

# Examine the results
summary = cph.summary[["coef", "p", "coef lower 95%", "coef upper 95%"]]
summary
```

In the summary table, at the $\alpha = 0.05$ level, we observe evidence that the $\beta$ for `age` and `treatment` is statistically different from 0. For `age`, the estimate of $\beta$ is positive, indicating that older individuals exhibit a ***higher*** instantaneous risk of experiencing the specified event (e.g. death). For `treatment`, we see that the estimate for $\beta$ is negative, indicating that individuals who receive the specified `treatment` (i.e. `treatment = 1`) exhibit a ***lower*** instantaneous risk of experiencing the specified event. Also note that the $\beta$ for `gender` is not statistically different from 0, indicating that `gender` probably does not influence an individual's risk.

### Conclusion

To summarize, the Cox Proportional Hazards Model is a useful tool for analyzing time-to-event data, especially in healthcare and clinical research. It allows us to quantify how different factors influence the timing of critical events.

I invite you to further study the [math behind the model](https://www.graphpad.com/guides/prism/latest/statistics/stat_cox_regression_mathematics.htm) and/or find a dataset of interest (e.g. from [Kaggle’s medical datasets](https://www.kaggle.com/datasets/gilsousa/habermans-survival-data-set)) and try fitting a Cox model using `lifelines`. After interpreting the results, you may consder sharing your findings in a GitHub repo or in a blog post like this one.